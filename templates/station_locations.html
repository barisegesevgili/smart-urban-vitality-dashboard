{% extends "base.html" %}

{% block title %}Smart-Urban-Vitality - Station Locations{% endblock %}

{% block extra_head %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNF6uExCzzggGGH2rlu2ljvf6SfOINtbY"></script>
<style>
    #map {
        height: 70vh;
        width: 100%;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .info-window {
        padding: 10px;
    }
    .info-window h3 {
        margin-top: 0;
        margin-bottom: 10px;
    }
    .info-window p {
        margin: 5px 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center mb-4">Station Locations</h1>
    <div id="map"></div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function initMap() {
        const map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: { lat: 48.1500, lng: 11.5833 } // Munich center
        });

        const stations = [
            { lat: 48.1500, lng: 11.5833, name: 'Englischer Garten', id: 1 },
            { lat: 48.2620, lng: 11.6670, name: 'Garching TUM Campus', id: 2 },
            { lat: 48.2510, lng: 11.6520, name: 'Garching Mensa', id: 3 }
        ];

        stations.forEach(station => {
            const marker = new google.maps.Marker({
                position: { lat: station.lat, lng: station.lng },
                map: map,
                title: station.name
            });

            marker.addListener('click', () => {
                fetch(`/sensor_data/${station.id}`)
                    .then(response => response.json())
                    .then(data => {
                        const content = `
                            <div class="info-window">
                                <h3>${station.name}</h3>
                                <p>Temperature: ${data.temperature}Â°C</p>
                                <p>Humidity: ${data.humidity}%</p>
                                <p>UV Index: ${data.uv_index}</p>
                                <p>Air Quality: ${data.air_quality}</p>
                                <p>CO2e: ${data.co2e} ppm</p>
                                <p>Fill Level: ${data.fill_level}%</p>
                                <p>Last Updated: ${new Date(data.timestamp).toLocaleString()}</p>
                            </div>
                        `;

                        const infoWindow = new google.maps.InfoWindow({
                            content: content
                        });

                        infoWindow.open(map, marker);
                    })
                    .catch(error => {
                        const content = `
                            <div class="info-window">
                                <h3>${station.name}</h3>
                                <p>No data available</p>
                            </div>
                        `;

                        const infoWindow = new google.maps.InfoWindow({
                            content: content
                        });

                        infoWindow.open(map, marker);
                    });
            });
        });
    }

    window.onload = initMap;
</script>
{% endblock %} 